<!--ECF JONATHAN-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.2.1/css/all.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>APIMOCK</title>
  </head>
  <body>
    <h1>Api mock</h1>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <p>
          Lecture de l'adresse depuis:
            <a href="https://6057e432c3f49200173ad08d.mockapi.io/employees">https://6057e432c3f49200173ad08d.mockapi.io/employees</a>
          </p>
                  <!--Charger la liste-->
          <button class="reader" type="button" onclick="lance()">
            <span class="fa-stack fa-1x icons_margin">
              <i class="fa-solid fa fa-circle fa-stack-2x"></i>
              <i class="fa-regular fa-eye fa-inverse fa-stack-1x"></i>
            </span>
          </button>
                  <!--Recharger la liste apres modif-->
          <button class="reader" type="button" onclick=document.location.reload(true)>
            <span class="fa-stack fa-1x icons_margin">
              <i class="fa-solid fa fa-circle fa-stack-2x"></i>
              <i class="fa-solid fa-arrow-rotate-right fa-inverse fa-stack-1x"></i>
            </span>
          </button>
                  <!--Table qui va recevoir les données-->
          <div class="table-wrapper-scroll-y my-custom-scrollbar">
            <table class="table table-bordered table-striped mb-0" id="j1">
                <tr>
                  <th>id</th>
                  <th>last_name</th>
                  <th>Name</th>
                  <th>Job Title</th>
                  <th>email</th>
                  <th>select</th>
                  <th>Delete</th>
                </tr>
              </table>
          </div> <!--Fin div table-->
        </div> <!--Fin div col-md-->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModaltoadd">Ajouter un item</button>
      </div> <!--Fin div row-->
        



                                <!-- Modal pour supprimer
        <div class="modal fade" id="myModaltodelete" role="dialog">
          <div class="modal-dialog">
                                <!--Contenu de la modal
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Supprimer l'item</h4>
              </div>
              <div class="modal-body">
                <p>Etes-vous sur de vouloir supprimer ?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="Supprimeritem(getid(id))">Supprimer</button>
              </div>
            </div>
          </div>
        </divFin> div modal pour supprimer-->

                                  <!--Modal pour modifier-->
                        
                                  <div class="modal fade" id="test" role="dialog">
                                    <div class="modal-dialog">
                                                          
                                      <div class="modal-content">
                                        <div class="modal-header">   
                                          <h4 class="modal-title">Modifier l'item</h4>
                                        </div>
                                        <div class="modal-body">
                                          <form id="jsp">
                                            <label>Last name:
                                              <input type="text"  id="alteritemlast_lastname" />
                                            </label>
                                            <label>Firs tName:
                                              <input type="text"  id="alteritemfirst_name" />
                                            </label>
                                            <label>Job Title:
                                              <input type="text"  id="alteritemjob_title" />
                                            </label>
                                            <label>email:
                                              <input type="text"  id="alteritememail" />
                                            </label>

                                          </form>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                                          <button type="button" class="btn btn-primary" data-dismiss="modal" id="savethemodif">save</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div> 

                                    <!--Modal Pour ajouter-->
        <div class="modal fade" id="myModaltoadd" tabindex="-1" role="dialog" aria-labelledby="addmodal" aria-hidden="true">
          <div class="modal-dialog" role="document">
                                    <!--Contenu de la modal-->
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addmodaltitle">Ajouter</h5>
              </div>
              <div class="modal-body">
                  <div class="form-group">
                    <form id="formtoadd">
                      <label>Last Name:
                        <input type="text" placeholder="Last Name" id="newitemlast_name" />
                      </label>
                      <label>First Name:
                        <input type="text" placeholder="First Name"  id="newitemname" />
                      </label>
                      <label>Job Title:
                        <input type="text" placeholder="Titre du job" id="newitemjob_title"/>
                      </label>
                      <label>email:
                        <input type="email" placeholder="joedoe@gmail.com"  id="newitememail"/>
                      </label>
                    </form>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="additem()" data-dismiss="modal">Ajouter</button>
                  </div>
            </div>
          </div>
        </div><!--Fin modal pour ajouter-->

    </div><!--Fin div container-->

    
      <script>
        function edititem(){
          console.log("function editiem avec lid :"+ id)
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
            } else {
              //document.getElementById("adress-output").innerHTML="error";
              //console.log("dans le else de la fonction alter");
            }
          };
          xhttp.open(
            "UPDATE",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.setRequestHeader(
            "Content-type",
            "application/x-www-form-urlencoded"
          );
          
          xhttp.send(
            "name=" + document.getElementById("alteritemlast_name").value + "&" +
            "last_name=" + document.getElementById("alteritemname").value + "&" +
            "job_title=" + document.getElementById("alteritemjob_title").value + "&" +
            "email=" + document.getElementById("alteritememail").value
          );
        }

        function deleteitem(id){
          console.log("l'item a supprimer est id :" + id)
            var result = confirm("Vous allez supprimer l'élément");
            if (result == true) {
              var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              console.log(xparsed)
            } else {}
          };
          xhttp.open(
            "DELETE",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.send(JSON.stringify({id: id,}));
            console.log('tu as bien supprimer l item')
            console.log(id)
                
            } else {}
            
        }


        function fill(id){
          console.log('pour remplir les formulaire de modification de l id :'+id)
          
          var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              console.log(xparsed.id)
              const info = document.getElementById('jsp')
              document.getElementById('alteritemlast_lastname').value=xparsed.last_name
              document.getElementById('alteritemfirst_name').value=xparsed.name
              document.getElementById('alteritemjob_title').value=xparsed.job_title
              document.getElementById('alteritememail').value=xparsed.email
            } else {}
          };
          xhttp.open(
            "GET",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.send();
          console.log("voici l'id de fill id:"+id)
          const saveform= document.getElementById('savethemodif')
          saveform.addEventListener('click', bonjour(id));

          
          }

        function bonjour(id){
          console.log("le click pour sauvegarder les modifs"+id)
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
            } else {}
          };
          xhttp.open(
            "PUT",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.setRequestHeader(
            "Content-type",
            "application/x-www-form-urlencoded"
          );
          
          xhttp.send(
            "name=" + document.getElementById("alteritemlast_name").value + "&" +
            "last_name=" + document.getElementById("alteritemname").value + "&" +
            "job_title=" + document.getElementById("alteritemjob_title").value + "&" +
            "email=" + document.getElementById("alteritememail").value
          );
          
        }

        

        /*Remplir le tableau avec les données*/
        function lance() {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              const info = document.getElementById("j1");
              //*for (let i = 0; i < xparsed.length; i++) {
              // var newlist= xparsed[i]
              //console.log("typeof info", typeof info);
              xparsed.forEach((element) => {
                info.innerHTML += 
                "<tr>"+
                //info.innerHTML +=
                  "<td>" +
                  element.id +
                  "</td>" +
                  "<td>" +
                  element.last_name +
                  "</td>" +
                  "<td>" +
                  element.name +
                  "</td>" +
                  "<td>" +
                  element.job_title +
                  "</td>" +
                  "<td>" +
                  element.email +
                  "</td>" +
                  '<td><button type="button"  class="btn btn-primary" data-toggle="modal" data-target="#test" onclick="fill('+element.id+');"><i class="fas fa-pencil"></i></button></td>' + //recupere l'id par ligne avec le element.id que l'on passe en parametre de fonctions pour les modif
                  '<td><button type="button"  class="btn btn-danger" onclick="getid('+element.id+');deleteitem('+element.id+')" data-toggle="modal" data-target="#myModaltodelete" title="Delete"><i class="fas fa-trash fa-inverse"></i></button></td>';//recupere l'id par ligne avec le element.id que l'on passe en parametre de fonctions pour les suppressions
                info.innerHTML += "</tr>";
                //});
              });
            } else {
              //document.getElementById("adress-output").innerHTML="error";
              //console.log("dans le else de la fonction lance");
            }
          };
          xhttp.open(
            "GET",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees",
            true
          );
          xhttp.send();
        }


        /*Funtion permettant d'ajouter un item a la liste*/
        function additem() {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              //console.log(xparsed);
            } else {
              //document.getElementById("adress-output").innerHTML="error";
              //console.log("dans le else de la fonction alter");
            }
          };
          xhttp.open(
            "POST",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees",
            true
          );
          xhttp.setRequestHeader(
            "Content-type",
            "application/x-www-form-urlencoded"
          );
          
          xhttp.send(
            "name=" + document.getElementById("newitemlast_name").value + "&" +
            "last_name=" + document.getElementById("newitemname").value + "&" +
            "job_title=" + document.getElementById("newitemjob_title").value + "&" +
            "email=" + document.getElementById("newitememail").value
          );
          //console.log("apres le send de obj");
        }
        

          /*Function pour modifier un item de la liste*/
          function getid(id) {
            console.log("l'id de cette ligne est :" + id)
            /** pour parcourir le tableau
            var rows = document.getElementById("j1").rows;
            for (i = 0; i < rows.length; i++) {
                rows[i].onclick = (function () {
                  return function () {
                    var id = this.cells[0].innerHTML;
                    var nom = this.cells[1].innerHTML;
                    var ijob = this.cells[2].innterHTML;
                    return id
                  alert("id:" + id +"\n"+ "name:"+nom+ "\n"+ "job title: "+ ijob);
                  console.log(id )
                  };
                  
                })(rows[i]);
            }
            console.log(id)*/

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              //console.log(xparsed)
              
              //*for (let i = 0; i < xparsed.length; i++) {
              // var newlist= xparsed[i]
              //console.log("le retour du get pour un id est:"+ xparsed);
            } else {
              //document.getElementById("adress-output").innerHTML="error";
              //console.log("dans le else de la fonction lance");
            }
          };
          xhttp.open(
            "GET",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.send();
          return id
        }
        
        
        /*
        function showdeletemodal(id){
          console.log("l'id de ce showdeletemodal est :" + id)
            /** pour parcourir le tableau
            var rows = document.getElementById("j1").rows;
            for (i = 0; i < rows.length; i++) {
                rows[i].onclick = (function () {
                  return function () {
                    var id = this.cells[0].innerHTML;
                    var nom = this.cells[1].innerHTML;
                    var ijob = this.cells[2].innterHTML;
                    return id
                  alert("id:" + id +"\n"+ "name:"+nom+ "\n"+ "job title: "+ ijob);
                  console.log(id )
                  };
                  
                })(rows[i]);
            }
            console.log(id)

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              console.log(xparsed)
            } else {}
          };
          xhttp.open(
            "GET",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.send();
          
        }
          
          function Supprimeritem(id){
            
            
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              var x = this.responseText;
              var xparsed = JSON.parse(x);
              console.log(xparsed)
              
              //*for (let i = 0; i < xparsed.length; i++) {
              // var newlist= xparsed[i]
              //console.log("le retour du get pour un id est:"+ xparsed);
            } else {
              //document.getElementById("adress-output").innerHTML="error";
              //console.log("dans le else de la fonction lance");
            }
          };
          xhttp.open(
            "DELETE",
            "https://6057e432c3f49200173ad08d.mockapi.io/employees/"+id,
            true
          );
          xhttp.send(JSON.stringify({id: id,}));
            console.log('tu as bien supprimer l item')
            console.log(id)
          }
          */

                    
              
            
      </script>
  </body>
</html>
